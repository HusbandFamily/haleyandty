<body>
    <div class="container">
        <!-- Secret Code Input -->
        <div id="code-container">
            <h2>Enter Your Guest Code</h2>
            <input type="text" id="guestCodeInput" placeholder="Enter your code">
            <button onclick="checkCode()">Submit</button>
            <p id="errorMessage" style="color: red; display: none;">Invalid code. Try again.</p>
        </div>

        <!-- Hidden Form -->
        <div id="rsvp-form" style="display: none;">
            <h2>RSVP Form</h2>
            <form id="contactForm">
                <label>Name</label>
                <input type="text" name="name" required>

                <label>RSVP</label>
                <input type="text" name="rsvp" required>

                <label>Dietary Restrictions</label>
                <textarea name="diet" required></textarea>

                <input type="hidden" name="code" id="hiddenCode">
                <button type="submit">Send</button>
            </form>
        </div>

        <script>
            const scriptURL = "https://script.google.com/macros/s/AKfycbxYJj35YzZKOhYvjI4DRLxihvbYupkJEp_OCVu4OrWLoe3e7FxeTzycglWeFHxUoDd-/exec";
            
            function checkCode() {
                const code = document.getElementById('guestCodeInput').value;
                fetch(scriptURL + '?code=' + code)
                    .then(response => response.text())
                    .then(data => {
                        if (data === 'valid') {
                            // Store code in browser so they don't enter it again
                            localStorage.setItem('guestCode', code);

                            // Reveal the form and pass the code along
                            document.getElementById('code-container').style.display = 'none';
                            document.getElementById('rsvp-form').style.display = 'block';
                            document.getElementById('hiddenCode').value = code;
                        } else {
                            document.getElementById('errorMessage').style.display = 'block';
                        }
                    });
            }

            // Auto-reveal the form if code was already entered
            const savedCode = localStorage.getItem('guestCode');
            if (savedCode) {
                document.getElementById('guestCodeInput').value = savedCode;
                checkCode();
            }
        </script>
    </div>
</body>
