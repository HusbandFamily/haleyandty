<body>
    <div class="container">
        <!-- Secret Code Section -->
        <div id="codeSection">
            <h2>Enter Your Guest Code</h2>
            <input type="text" id="guestCodeInput" placeholder="Enter your code">
            <button onclick="checkCode()">Submit</button>
            <p id="errorMessage" style="color: red; display: none;">Invalid code. Try again.</p>
        </div>

        <!-- Hidden RSVP Form -->
        <div id="formSection" style="display: none;">
            <form id="contactForm">
                <label>Name</label>
                <input type="text" name="name" placeholder="Your Name" required>

                <label>RSVP</label>
                <input type="text" name="rsvp" placeholder="RSVP (Yes/No)" required>

                <label>Dietary Restrictions</label>
                <textarea name="diet" placeholder="Your Dietary Restrictions"></textarea>

                <input type="hidden" name="code" id="hiddenCode">
                <button type="submit">Send</button>
            </form>
        </div>
    </div>

<script>
    const validCodes = {
        "Husband": "Husband",
        "Clarke": "Clarke",
    };

    function checkCode() {
        const codeInput = document.getElementById('guestCodeInput').value.trim().toUpperCase();
        const errorMessage = document.getElementById('errorMessage');
        const formSection = document.getElementById('formSection');
        const codeSection = document.getElementById('codeSection');
        const nameField = document.querySelector('input[name="name"]');
        const hiddenCodeField = document.getElementById('hiddenCode');

        if (validCodes.hasOwnProperty(codeInput)) {
            // ✅ Valid code - reveal the form
            codeSection.style.display = 'none';
            formSection.style.display = 'block';

            // ✅ Automatically populate the name and hidden code
            nameField.value = validCodes[codeInput];
            hiddenCodeField.value = codeInput;
        } else {
            // ❌ Invalid code - show error message and shake effect
            errorMessage.style.display = 'block';
            document.getElementById('guestCodeInput').classList.add('shake');

            setTimeout(() => {
                document.getElementById('guestCodeInput').classList.remove('shake');
            }, 500);
        }
    }

    // ✅ Handle Form Submission
    const scriptURL = "https://script.google.com/macros/s/AKfycbxYJj35YzZKOhYvjI4DRLxihvbYupkJEp_OCVu4OrWLoe3e7FxeTzycglWeFHxUoDd-/exec";
    const form = document.getElementById('contactForm');

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        fetch(scriptURL, {
            method: "POST",
            body: new URLSearchParams(new FormData(form))
        })
        .then(response => response.text())
        .then(data => {
            if (data === "Success") {
                alert("RSVP Submitted! Thank you.");
                form.reset();
                window.location.reload();
            } else {
                alert("There was an error submitting your RSVP. Please try again.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("There was an error processing your RSVP.");
        });
    });
</script>

<style>
    /* 💅 Add a subtle shake effect for wrong codes */
    .shake {
        animation: shake 0.2s ease-in-out;
    }

    @keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        50% { transform: translateX(5px); }
        75% { transform: translateX(-5px); }
        100% { transform: translateX(0); }
    }
</style>
</body>
